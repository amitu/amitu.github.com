<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7 ie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8 ie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9 ie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Amit Upadhyay: Understanding South</title>
	<meta name="author" content="Amit Upadhyay">
	<link href='/theme/css/style.css' rel="stylesheet" media="all">
	<link href="http://amitu.com/atom.xml" rel="alternate" title="" type="application/atom+xml">
	<script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.0.6/modernizr.min.js"></script>
</head>
<body ng-app>
<div id="fb-root"></div>
<div id="page" class="hentry">
	<header class="the-header">
		<div class="unit-head">
			<div class="unit-inner unit-head-inner">
				<nav class="nav-global">
					<ul>
                        
                            <li class="logo"><a href="/">Amit Upadhyay</a></li>
                            <li class="page"><a href="/">blog</a></li>
                            <li class="page"><a href="/open-source.html">open source</a></li>
                            <li class="page"><a href="/quotes.html">quotes</a></li>
                            <li class="page"><a href="/python/">python</a></li>
                            <li class="page"><a href="/india/">India</a></li>
                        
					</ul>
				</nav>
			</div><!-- unit-inner -->
		</div><!-- unit-head -->
	</header>
	<div class="body" role="main">
		<div class="unit-body">
			<div class="unit-inner unit-body-inner">
				<div class="entry-content">
                    
<article class="unit-article layout-post">
	<div class="unit-inner unit-article-inner">
		<div class="content">
			<header>
				<div class="unit-head">
					<div class="unit-inner unit-head-inner">
						<h1 class="h2 entry-title">Understanding South</h1>
					</div><!-- unit-inner -->
				</div><!-- unit-head -->
			</header>

			<div class="bd">
				<div class="entry-content">
					<p>First, django is composed of applications. South manages things at this
application level. Each application can be "migration enabled" or not.</p>
<p>Next: south does not overtake syncdb, but "enhances" it, syncdb is still
required.</p>
<p>If we want to start using south, the first thing after installing it, is
adding south to INSTALLED_APPS. Once this is done, south enhances 
syncdb command.</p>
<p>If we are starting a new app, we will first thing run syncdb. If we have
an existing deployed app, our database and tables are already in place.
South handles both with same ease.</p>
<p>What south cares about if the application is "migration enabled". What
it means is if app.migrations package exists or not. If the .migrations
package exist on any app, south enhanced syncdb leaves it alone.</p>
<p>What this means if if your project depends on many third party apps, you
will not have to bother with creating migrations for them. You can
always create them, in case the thirdparty app goes through db schema
changes, but lets say that never happens and third party apps are either
"stable" or they come with their own migrations package.</p>
<p>So everything starts with syncdb run. For every app which is not
"migration enabled", syncdb creates the tables as if south is not
present at all.</p>
<p>Now one of those apps are your apps, which is going to need migration.
For that app, again either tables are already present or you are going
to start from scratch. In either case we have to create "initial
migration" for the app.</p>
<p>When we say migration, it just means a python module in the .migrations
package. So when we create a migration, only a python module is created,
and nothing changes in database. The migration module contains how to
create table, remove tables, add/remove columns etc, to get from
original database state to next database state.</p>
<p>To create the initial migration, you can call <strong>python manage.py
schemamigration app --initial</strong>. The command should have been named
"createmigration" instead of "schemamigration". This command will create
the migrations package if it does not exist, and create a
0001_initial.py in it, eg app/migrations/0001_initial.py along with
app/migrations/__init__.py if required. This file will contain
python statements to create all tables in the app. Each app that is to
be migration enabled must have intial migration created.</p>
<p>Once the python module is created, we can "apply the migration", using
<strong>python manage.py migrate app</strong> or just <strong>python manage.py migrate</strong>.
This command looks for each "migration enabled" app, and looks for the
migrations each of them contains. Then it looks for a table
south_migrationhistory which stores for each app, which migration is
already in database. It then finds all the migrations that are not in
that table and applies them in alphabetical order.</p>
<p>This will try to creating/removing tables or columns as needed. If we
are starting with existing tables, our 0001_initial.py migration will
try to create tables that already exists, and will fail.</p>
<p>To handle this, south can "fake" a migration: <strong>python manage.py migrate
app --fake 0001</strong>. This will not actually create any tables etc, but
will updated the south_migrationhistory table to say that 001 migration
has been applied.</p>
<p>So how do we create a migration? South can automatically create
migrations for most cases by inspecting the current state of an app
models from south_migrationhistory database, each migration python
module btw contains a dump of entire database schema as it will be if
that migration was applied. South takes the latest state of database
from latest applied migration, and compares it with the current
models.py for the app, and automatically creates a migration when we do
<strong>python manage.py schemamigration app --auto</strong>. Again you can see if
the command was named createmigration, it would have been lot less
confusing.</p>
<p>Anyways, once we create the migration, we must apply it using "python
manage.py migrate".</p>
<p>Sometimes we may manually alter the database using raw SQL or other
means, in which case we must again create "initial" migration, and
"fake" it. We can do it anytime our migrations files are going out of
sync with our database.</p>
					<div class="meta">
                    <hr>
						<p class="date-publish">
							Published:
							<date class="date-pub" title="Nov. 3, 2013, midnight" datetime="Nov. 3, 2013, midnight" pubdate>
							<span class="month"><abbr>Nov</abbr></span>
							<span class="day">03</span>
							<span class="year">2013</span>
							</date>
						</p>
					</div><!-- meta -->
				</div><!-- entry-content -->

<figure class="kudo kudoable" data-id="1">
    <a class="kudobject">
        <div class="opening">
            <div class="circle">&nbsp;</div>
        </div>
    </a>
    <a href="#kudo" class="count">
        <span class="num">0</span>
        <span class="txt">Kudos</span>
    </a>
</figure>

				<div class="misc-content" style="padding-top: 30px">
					<div class="comment">
            <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'amitu';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); 
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

					</div>
				</div><!-- misc-content -->
			</div><!-- bd -->
			<footer class="unit-foot">
				<div class="unit-inner unit-foot-inner">
					<nav class="pagination">
						<ul>
							
							
							
						</ul>
					</nav>
					<!-- p class="gotop">
						<a href="#page">Back to Top</a>
					</p -->
				</div>
			</footer>

		</div><!-- content -->
	</div><!-- unit-inner -->
</article>

				</div>
			</div><!-- unit-inner -->
		</div><!-- unit-body -->
	</div><!-- body -->
	<footer class="the-footer">
		<div class="unit-foot">
			<div class="unit-inner unit-foot-inner">
                
				<div class="misc vcard">
					<h4>about</h4>
					<ul>
						<li class="contact"><address><span class="author fn n">Amit Upadhyay</span> - <span class="fn email">blog@amitu.com</span></address></li>
						<li class="github"><a href="http://github.com/amitu/" rel="me">github.com/amitu</a></li>
						<li class="twitter"><a href="http://twitter.com/amitu/" rel="me">twitter.com/amitu</a></li>
                        <!-- li class="linkedin"><a href="http://www.linkedin.com/in/amitu" rel="me">linkedin.com/in/amitu</a></li -->
                        <!-- li class="rss"><a href="http://eepurl.com/pRhOD">subscribe</a> (<a href="/2012/09/i-am-leaving-facebook-why-and-how-you-should-too/">why?</a>)</li -->
                        <li>Blog powered by <a href="https://github.com/amitu/djangothis">djangothis</a>.</li>
					</ul>
				</div><!-- misc -->
				<p class="licence">
					Theme: <a href="http://themes.jekyllbootstrap.com/preview/the-program/">the_minimum</a> based on <a href="http://jekyllbootstrap.com/">Jekyll-bootstrap</a>.<br>
				</p>
                
			</div><!-- unit-foot-inner -->
		</div><!-- unit-foot -->
	</footer>
</div><!-- page -->
<script>
/*! A fix for the iOS orientationchange zoom bug.Script by @scottjehl, rebound by @wilto. MIT License.*/
(function(j){var i=j.document;if(!i.querySelectorAll){return}var l=i.querySelectorAll("meta[name=viewport]")[0],a=l&&l.getAttribute("content"),h=a+", maximum-scale=1.0",d=a+", maximum-scale=10.0",g=true,c=j.orientation,k=0;if(!l){return}function f(){l.setAttribute("content",d);g=true}function b(){l.setAttribute("content",h);g=false}function e(m){c=Math.abs(j.orientation);k=Math.abs(m.gamma);if(k>8&&c===0){if(g){b()}}else{if(!g){f()}}}j.addEventListener("orientationchange",f,false);j.addEventListener("deviceorientation",e,false)})(this);
</script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script src="http://www.parsecdn.com/js/parse-1.2.3.min.js"></script>
  <script src="/static/kudos/jstorage.js"></script>
  <script src="/static/kudos/kudos.js"></script>
  <script src="/static/kudos/parse-kudos.js"></script>

</body>
</html>
